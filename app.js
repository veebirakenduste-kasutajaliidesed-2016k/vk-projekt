!function(){"use strict";var e=function(){return e.instance?e.instance:(e.instance=this,this.cacheStatusValues=["uncached","idle","checking","downloading","updateready","obsolete"],this.cache=window.applicationCache,this.startCacheListeners(),this.online=null,this.status=null,this.grids=[],void this.init())};window.onlinepad=e,e.prototype={init:function(){$("#mein").show(),this.checkDeviceStatus(),this.bindEvents(),"online"==this.online&&this.checkForOfflineGrids(),this.loadJSON()},startCacheListeners:function(){this.cache.addEventListener("cached",this.logEvent.bind(this),!1),this.cache.addEventListener("checking",this.logEvent.bind(this),!1),this.cache.addEventListener("downloading",this.logEvent.bind(this),!1),this.cache.addEventListener("error",this.logEvent.bind(this),!1),this.cache.addEventListener("noupdate",this.logEvent.bind(this),!1),this.cache.addEventListener("obsolete",this.logEvent.bind(this),!1),this.cache.addEventListener("progress",this.logEvent.bind(this),!1),this.cache.addEventListener("updateready",this.logEvent.bind(this),!1),window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache(),console.log("swap cache has been called")},!1),setInterval(function(){e.instance.cache.update()},1e4),setInterval(function(){e.instance.checkDeviceStatus()},100)},logEvent:function(e){this.status=this.cacheStatusValues[this.cache.status];var t="online: "+this.online+", event: "+e.type+", status: "+this.status;"error"==e.type&&navigator.onLine&&(t+=" (prolly a syntax error in manifest)")},bindEvents:function(){$("#reloadPage").click(function(){location.reload()}),$("#tonewtext").click(function(){e.instance.createFile()})},loadJSON:function(){if("online"==this.online)$.ajax({url:"getFiles.php",success:function(t){e.instance.printGrids(JSON.parse(t))},error:function(e,t,i){console.log(i)}});else{var t=$("<p>Olete hetkel offline ja saate ainult luua märkmeid, mis laetakse serverisse niipea kui olete uuesti online.</p>");$("#mein").html(t)}},checkForOfflineGrids:function(){if(localStorage.pendingFiles){var t=$.parseJSON(localStorage.getItem("pendingFiles"));localStorage.removeItem("pendingFiles"),e.instance.saveDiv("#####",t.fname,t.ftext)}},createFile:function(){$("#floater").show(),$("#mein").css("filter","blur(5px)").css("webkitFilter","blur(5px)").css("mozFilter","blur(5px)").css("oFilter","blur(5px)").css("msFilter","blur(5px)"),$("#header").css("filter","blur(5px)").css("webkitFilter","blur(5px)").css("mozFilter","blur(5px)").css("oFilter","blur(5px)").css("msFilter","blur(5px)"),$("#line").css("filter","blur(5px)").css("webkitFilter","blur(5px)").css("mozFilter","blur(5px)").css("oFilter","blur(5px)").css("msFilter","blur(5px)");var t='<div class="createText" style="border: 10px solid rgb(207, 216, 220);"><button id="closeText" style="margin-right: 10px;">Aken kinni</button><button id="saveNewText">Salvesta</button><br><br><input id="newHead" type="text" class="newFile" placeholder="Pealkiri"><br><br><textarea id="FileText" class="newFile" placeholder="Teie märkus siia..."></textarea></div>';t=$(t),$("body").append(t),$("#FileText").autogrow({onInitialize:!0}),$("#saveNewText").click(function(){var t=$("#newHead").val(),i=$("#FileText").val();if(console.log(e.instance.online),e.instance.online="offline","online"==e.instance.online)e.instance.saveDiv("#####",t,i);else{var n='{"fname":"'+t+'", "ftext":"'+i+'"}';localStorage.setItem("pendingFiles",n)}location.reload()}),$("#closeText, #floater").click(function(){t.remove(),$("#floater").hide(),console.log("pressed"),$("#mein").css("filter","none").css("webkitFilter","none").css("mozFilter","none").css("oFilter","none").css("msFilter","none"),$("#header").css("filter","none").css("webkitFilter","none").css("mozFilter","none").css("oFilter","none").css("msFilter","none"),$("#line").css("filter","none").css("webkitFilter","none").css("mozFilter","none").css("oFilter","none").css("msFilter","none")})},printFile:function(t,i,n){var s='<div class="showText" style="border: 10px solid '+n+';"><button id="close" style="margin-right: 10px;">Aken kinni</button><button id="edit">Muuda sisu</button><button id="saveText" style="display:none">Salvesta</button><button id="delText">Kustuta</button><h2 class="divTexts" style="display:block">'+t+'</h2><br class="brs" style="display:none"><br class="brs" style="display:none"><input id="textHead" type="text" class="divChanges" style="display:none" value="'+t+'"><p class="divTexts" style="display:block">'+i+'</p><br class="brs" style="display:none;"><br class="brs" style="display:none"><textarea id="changeFileText" class="divChanges" style="display:none">'+i+"</textarea></div>";s=$(s),$("body").append(s),$("#edit").click(function(){$(".divTexts").hide(),$("#edit").hide(),$(".brs").show(),$("#saveText").css("display","block"),$(".divChanges").show(),$("#changeFileText").autogrow({onInitialize:!0})}),$("#saveText").click(function(){var i=$("#textHead").val(),n=$("#changeFileText").val();e.instance.saveDiv(t,i,n)}),$("#delText").click(function(){e.instance.delDiv(t)}),$("#close, #floater").click(function(){s.remove(),$("#floater").hide(),console.log("pressed"),$("#mein").css("filter","none").css("webkitFilter","none").css("mozFilter","none").css("oFilter","none").css("msFilter","none"),$("#header").css("filter","none").css("webkitFilter","none").css("mozFilter","none").css("oFilter","none").css("msFilter","none"),$("#line").css("filter","none").css("webkitFilter","none").css("mozFilter","none").css("oFilter","none").css("msFilter","none")})},printGrids:function(t){var i=0,n=["rgb(255, 138, 128)","rgb(255, 209, 128)","rgb(255, 255, 141)","rgb(207, 216, 220)","rgb(128, 216, 255)","rgb(167, 255, 235)"];$.each(t,function(t,s){var l=Math.floor(5*Math.random()),o='<button id="'+i+'" class="grid-item" style="background-color:'+n[l]+';">'+s.fname.replace(/.txt/g,"")+"</button>";i+=1,o=$(o),$(".grid").append(o),$(o).click(function(t){var i;i=t.target.id,$("#floater").show(),$("#mein").css("filter","blur(5px)").css("webkitFilter","blur(5px)").css("mozFilter","blur(5px)").css("oFilter","blur(5px)").css("msFilter","blur(5px)"),$("#header").css("filter","blur(5px)").css("webkitFilter","blur(5px)").css("mozFilter","blur(5px)").css("oFilter","blur(5px)").css("msFilter","blur(5px)"),$("#line").css("filter","blur(5px)").css("webkitFilter","blur(5px)").css("mozFilter","blur(5px)").css("oFilter","blur(5px)").css("msFilter","blur(5px)"),e.instance.printFile(s.fname.replace(/.txt/g,""),s.ftext,n[l])})})},saveDiv:function(e,t,i){$.ajax({url:"saveFile.php",data:{fname:t,ftext:i,origfname:e},type:"post",success:function(e){console.log(e)}}),setTimeout(function(){location.reload()},500)},delDiv:function(e){$.ajax({url:"delFile.php",data:{fname:e},type:"post",success:function(e){console.log(e)}}),setTimeout(function(){location.reload()},500)},checkDeviceStatus:function(){this.online=navigator.onLine?"online":"offline","online"==this.online?console.log("bar online"):console.log("bar offline")}},window.onload=function(){new e}}();